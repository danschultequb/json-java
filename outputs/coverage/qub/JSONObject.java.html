<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JSONObject.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCo Coverage Report</a> &gt; <a href="index.source.html" class="el_package">qub</a> &gt; <span class="el_source">JSONObject.java</span></div><h1>JSONObject.java</h1><pre class="source lang-java linenums">package qub;

/**
 * A JSON object.
 */
public class JSONObject implements JSONSegment, MutableMap&lt;String,JSONSegment&gt;
{
    private final MutableMap&lt;String,JSONSegment&gt; properties;

    private JSONObject(MutableMap&lt;String,JSONSegment&gt; properties)
<span class="fc" id="L11">    {</span>
<span class="fc" id="L12">        PreCondition.assertNotNull(properties, &quot;properties&quot;);</span>

<span class="fc" id="L14">        this.properties = properties;</span>
<span class="fc" id="L15">    }</span>

    public static JSONObject create(JSONProperty... properties)
    {
<span class="fc" id="L19">        PreCondition.assertNotNull(properties, &quot;properties&quot;);</span>

<span class="fc" id="L21">        return JSONObject.create(Iterable.create(properties));</span>
    }

    public static JSONObject create(Iterable&lt;JSONProperty&gt; properties)
    {
<span class="fc" id="L26">        PreCondition.assertNotNull(properties, &quot;properties&quot;);</span>

<span class="fc" id="L28">        return JSONObject.create(properties.iterate());</span>
    }

    public static JSONObject create(Iterator&lt;JSONProperty&gt; properties)
    {
<span class="fc" id="L33">        PreCondition.assertNotNull(properties, &quot;properties&quot;);</span>

<span class="fc" id="L35">        return JSONObject.create(</span>
<span class="fc" id="L36">            properties.toMap(</span>
                JSONProperty::getName,
                JSONProperty::getValue));
    }

    public static JSONObject create(Map&lt;String,JSONSegment&gt; properties)
    {
<span class="fc" id="L43">        PreCondition.assertNotNull(properties, &quot;properties&quot;);</span>

<span class="fc" id="L45">        return new JSONObject(Map.create(properties));</span>
    }

    /**
     * Get whether or not this JSONObject contains a property with the provided name.
     * @param propertyName The name of the property to look for.
     * @return Whether or not this JSONObject contains a property with the provided name.
     */
    public boolean contains(String propertyName)
    {
<span class="fc" id="L55">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>

<span class="fc" id="L57">        return this.properties.containsKey(propertyName);</span>
    }

    @Override
    public boolean containsKey(String propertyName)
    {
<span class="fc" id="L63">        return this.contains(propertyName);</span>
    }

    @Override
    public Result&lt;JSONSegment&gt; get(String propertyName)
    {
<span class="fc" id="L69">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>

<span class="fc" id="L71">        return this.properties.get(propertyName)</span>
<span class="fc" id="L72">            .convertError(NotFoundException.class, () -&gt; new NotFoundException(&quot;No property found with the name: &quot; + Strings.escapeAndQuote(propertyName)));</span>
    }

    public &lt;T extends JSONSegment&gt; Result&lt;T&gt; get(String propertyName, java.lang.Class&lt;T&gt; propertyValueType)
    {
<span class="fc" id="L77">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>

<span class="fc" id="L79">        return this.get(propertyName)</span>
<span class="fc" id="L80">            .then((JSONSegment propertyValue) -&gt; JSON.as(propertyValue, propertyValueType, JSON.thePropertyNamed(propertyName)).await());</span>
    }

    private &lt;T extends JSONSegment&gt; Result&lt;T&gt; getOrNull(String propertyName, java.lang.Class&lt;T&gt; propertyValueType)
    {
<span class="fc" id="L85">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>

<span class="fc" id="L87">        return this.get(propertyName)</span>
<span class="fc" id="L88">            .then((JSONSegment propertyValue) -&gt; JSON.asOrNull(propertyValue, propertyValueType, JSON.thePropertyNamed(propertyName)).await());</span>
    }

    public Result&lt;JSONObject&gt; getObject(String propertyName)
    {
<span class="fc" id="L93">        return this.get(propertyName, JSONObject.class);</span>
    }

    public Result&lt;JSONObject&gt; getObjectOrNull(String propertyName)
    {
<span class="fc" id="L98">        return this.getOrNull(propertyName, JSONObject.class);</span>
    }

    public Result&lt;JSONArray&gt; getArray(String propertyName)
    {
<span class="fc" id="L103">        return this.get(propertyName, JSONArray.class);</span>
    }

    public Result&lt;JSONArray&gt; getArrayOrNull(String propertyName)
    {
<span class="fc" id="L108">        return this.getOrNull(propertyName, JSONArray.class);</span>
    }

    public Result&lt;JSONBoolean&gt; getBooleanSegment(String propertyName)
    {
<span class="fc" id="L113">        return this.get(propertyName, JSONBoolean.class);</span>
    }

    public Result&lt;Boolean&gt; getBoolean(String propertyName)
    {
<span class="fc" id="L118">        return this.getBooleanSegment(propertyName)</span>
<span class="fc" id="L119">            .then(JSONBoolean::getValue);</span>
    }

    public Result&lt;Boolean&gt; getBooleanOrNull(String propertyName)
    {
<span class="fc" id="L124">        return this.getOrNull(propertyName, JSONBoolean.class)</span>
<span class="fc" id="L125">            .then(JSON::toBooleanOrNull);</span>
    }

    public Result&lt;JSONNumber&gt; getNumberSegment(String propertyName)
    {
<span class="fc" id="L130">        return this.get(propertyName, JSONNumber.class);</span>
    }

    public Result&lt;Double&gt; getNumber(String propertyName)
    {
<span class="fc" id="L135">        return this.getNumberSegment(propertyName)</span>
<span class="fc" id="L136">            .then(JSONNumber::getValue);</span>
    }

    public Result&lt;Double&gt; getNumberOrNull(String propertyName)
    {
<span class="fc" id="L141">        return this.getOrNull(propertyName, JSONNumber.class)</span>
<span class="fc" id="L142">            .then(JSON::toNumberOrNull);</span>
    }

    public Result&lt;Void&gt; getNull(String propertyName)
    {
<span class="fc" id="L147">        return this.get(propertyName, JSONNull.class)</span>
<span class="fc" id="L148">            .then(() -&gt; null);</span>
    }

    public Result&lt;JSONString&gt; getStringSegment(String propertyName)
    {
<span class="fc" id="L153">        return this.get(propertyName, JSONString.class);</span>
    }

    public Result&lt;String&gt; getString(String propertyName)
    {
<span class="fc" id="L158">        return this.getStringSegment(propertyName)</span>
<span class="fc" id="L159">            .then(JSONString::getValue);</span>
    }

    public Result&lt;String&gt; getStringOrNull(String propertyName)
    {
<span class="fc" id="L164">        return this.getOrNull(propertyName, JSONString.class)</span>
<span class="fc" id="L165">            .then(JSON::toStringOrNull);</span>
    }

    public Result&lt;JSONProperty&gt; getProperty(String propertyName)
    {
<span class="fc" id="L170">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>

<span class="fc" id="L172">        return this.get(propertyName)</span>
<span class="fc" id="L173">            .then((JSONSegment propertyValue) -&gt; JSONProperty.create(propertyName, propertyValue));</span>
    }

    /**
     * Get the names of the properties in this JSONObject.
     * @return The names of the properties in this JSONObject.
     */
    public Iterable&lt;String&gt; getPropertyNames()
    {
<span class="fc" id="L182">        return this.properties.getKeys();</span>
    }

    @Override
    public Iterable&lt;String&gt; getKeys()
    {
<span class="fc" id="L188">        return this.getPropertyNames();</span>
    }

    /**
     * Get the values of the properties in this JSONObject.
     * @return The values of the properties in this JSONObject.
     */
    public Iterable&lt;JSONSegment&gt; getPropertyValues()
    {
<span class="fc" id="L197">        return this.properties.getValues();</span>
    }

    @Override
    public Iterable&lt;JSONSegment&gt; getValues()
    {
<span class="fc" id="L203">        return this.getPropertyValues();</span>
    }

    /**
     * Get the properties in this JSONObject.
     * @return The properties in this JSONObject.
     */
    public Iterable&lt;JSONProperty&gt; getProperties()
    {
<span class="fc" id="L212">        return this.properties.map((MapEntry&lt;String,JSONSegment&gt; entry) -&gt; JSONProperty.create(entry.getKey(), entry.getValue()));</span>
    }

    @Override
    public Iterator&lt;MapEntry&lt;String,JSONSegment&gt;&gt; iterate()
    {
<span class="fc" id="L218">        return this.properties.iterate();</span>
    }

    @Override
    public JSONObject clear()
    {
<span class="fc" id="L224">        this.properties.clear();</span>
<span class="fc" id="L225">        return this;</span>
    }

    @Override
    public JSONObject set(String propertyName, JSONSegment propertyValue)
    {
<span class="fc" id="L231">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>
<span class="fc" id="L232">        PreCondition.assertNotNull(propertyValue, &quot;propertyValue&quot;);</span>

<span class="fc" id="L234">        this.properties.set(propertyName, propertyValue);</span>

<span class="fc" id="L236">        return this;</span>
    }

    @Override
    public JSONObject setAll(Iterable&lt;MapEntry&lt;String,JSONSegment&gt;&gt; properties)
    {
<span class="fc" id="L242">        PreCondition.assertNotNull(properties, &quot;properties&quot;);</span>

<span class="fc" id="L244">        MutableMap.super.setAll(properties);</span>

<span class="fc" id="L246">        return this;</span>
    }

    public JSONObject set(MapEntry&lt;String,JSONSegment&gt; property)
    {
<span class="fc" id="L251">        PreCondition.assertNotNull(property, &quot;property&quot;);</span>

<span class="fc" id="L253">        return this.set(property.getKey(), property.getValue());</span>
    }

    public JSONObject setObject(String propertyName, JSONObject propertyValue)
    {
<span class="fc" id="L258">        PreCondition.assertNotNull(propertyValue, &quot;propertyValue&quot;);</span>

<span class="fc" id="L260">        return this.set(propertyName, propertyValue);</span>
    }

    public JSONObject setObjectOrNull(String propertyName, JSONObject propertyValue)
    {
<span class="fc bfc" id="L265" title="All 2 branches covered.">        return this.set(propertyName, propertyValue == null ? JSONNull.segment : propertyValue);</span>
    }

    public JSONObject setArray(String propertyName, JSONArray propertyValue)
    {
<span class="fc" id="L270">        PreCondition.assertNotNull(propertyValue, &quot;propertyValue&quot;);</span>

<span class="fc" id="L272">        return this.set(propertyName, propertyValue);</span>
    }

    public JSONObject setArrayOrNull(String propertyName, JSONArray propertyValue)
    {
<span class="fc bfc" id="L277" title="All 2 branches covered.">        return this.set(propertyName, propertyValue == null ? JSONNull.segment : propertyValue);</span>
    }

    public JSONObject setArray(String propertyName, Iterable&lt;JSONSegment&gt; arrayElements)
    {
<span class="nc" id="L282">        PreCondition.assertNotNull(arrayElements, &quot;arrayElements&quot;);</span>

<span class="nc" id="L284">        return this.setArray(propertyName, JSONArray.create(arrayElements));</span>
    }

    public JSONObject setArrayOrNull(String propertyName, Iterable&lt;JSONSegment&gt; arrayElements)
    {
<span class="nc bnc" id="L289" title="All 2 branches missed.">        return this.set(propertyName, arrayElements == null ? JSONNull.segment : JSONArray.create(arrayElements));</span>
    }

    public JSONObject setNull(String propertyName)
    {
<span class="fc" id="L294">        return this.set(propertyName, JSONNull.segment);</span>
    }

    public JSONObject setBoolean(String propertyName, boolean propertyValue)
    {
<span class="fc" id="L299">        return this.set(propertyName, JSONBoolean.get(propertyValue));</span>
    }

    public JSONObject setBooleanOrNull(String propertyName, Boolean propertyValue)
    {
<span class="fc bfc" id="L304" title="All 2 branches covered.">        return this.set(propertyName, propertyValue == null ? JSONNull.segment : JSONBoolean.get(propertyValue));</span>
    }

    public JSONObject setNumber(String propertyName, long propertyValue)
    {
<span class="fc" id="L309">        return this.set(propertyName, JSONNumber.get(propertyValue));</span>
    }

    public JSONObject setNumber(String propertyName, double propertyValue)
    {
<span class="fc" id="L314">        return this.set(propertyName, JSONNumber.get(propertyValue));</span>
    }

    public JSONObject setNumberOrNull(String propertyName, Integer propertyValue)
    {
<span class="fc bfc" id="L319" title="All 2 branches covered.">        return this.set(propertyName, propertyValue == null ? JSONNull.segment : JSONNumber.get(propertyValue));</span>
    }

    public JSONObject setNumberOrNull(String propertyName, Long propertyValue)
    {
<span class="fc bfc" id="L324" title="All 2 branches covered.">        return this.set(propertyName, propertyValue == null ? JSONNull.segment : JSONNumber.get(propertyValue));</span>
    }

    public JSONObject setNumberOrNull(String propertyName, Float propertyValue)
    {
<span class="fc bfc" id="L329" title="All 2 branches covered.">        return this.set(propertyName, propertyValue == null ? JSONNull.segment : JSONNumber.get(propertyValue));</span>
    }

    public JSONObject setNumberOrNull(String propertyName, Double propertyValue)
    {
<span class="fc bfc" id="L334" title="All 2 branches covered.">        return this.set(propertyName, propertyValue == null ? JSONNull.segment : JSONNumber.get(propertyValue));</span>
    }

    public JSONObject setString(String propertyName, String propertyValue)
    {
<span class="fc" id="L339">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>
<span class="fc" id="L340">        PreCondition.assertNotNull(propertyValue, &quot;propertyValue&quot;);</span>

<span class="fc" id="L342">        return this.set(propertyName, JSONString.get(propertyValue));</span>
    }

    public JSONObject setStringOrNull(String propertyName, String propertyValue)
    {
<span class="fc" id="L347">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>

<span class="fc bfc" id="L349" title="All 2 branches covered.">        return this.set(propertyName, propertyValue == null ? JSONNull.segment : JSONString.get(propertyValue));</span>
    }

    @Override
    public Result&lt;JSONSegment&gt; remove(String propertyName)
    {
<span class="fc" id="L355">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>

<span class="fc" id="L357">        return this.properties.remove(propertyName)</span>
<span class="fc" id="L358">            .convertError(NotFoundException.class, () -&gt; new NotFoundException(&quot;No property exists in this JSONObject with the name: &quot; + Strings.escapeAndQuote(propertyName)));</span>
    }

    @Override
    public String toString()
    {
<span class="fc" id="L364">        return JSONSegment.toString(this);</span>
    }

    @Override
    public Result&lt;Integer&gt; toString(IndentedCharacterWriteStream stream, JSONFormat format)
    {
<span class="fc" id="L370">        PreCondition.assertNotNull(stream, &quot;stream&quot;);</span>
<span class="fc" id="L371">        PreCondition.assertNotDisposed(stream, &quot;stream&quot;);</span>
<span class="fc" id="L372">        PreCondition.assertNotNull(format, &quot;format&quot;);</span>

<span class="fc" id="L374">        stream.setSingleIndent(format.getSingleIndent());</span>

<span class="fc" id="L376">        final String newLine = format.getNewLine();</span>
<span class="fc bfc" id="L377" title="All 2 branches covered.">        final boolean hasNewLine = !Strings.isNullOrEmpty(newLine);</span>

<span class="fc" id="L379">        return Result.create(() -&gt;</span>
        {
<span class="fc" id="L381">            int result = 0;</span>

<span class="fc" id="L383">            result += stream.write('{').await();</span>
<span class="fc" id="L384">            stream.increaseIndent();</span>
            try
            {
<span class="fc" id="L387">                boolean wroteProperty = false;</span>
<span class="fc bfc" id="L388" title="All 2 branches covered.">                for (final JSONProperty property : this.getProperties())</span>
                {
<span class="fc bfc" id="L390" title="All 2 branches covered.">                    if (!wroteProperty)</span>
                    {
<span class="fc" id="L392">                        wroteProperty = true;</span>
                    }
                    else
                    {
<span class="fc" id="L396">                        result += stream.write(',').await();</span>
                    }
<span class="fc bfc" id="L398" title="All 2 branches covered.">                    if (hasNewLine)</span>
                    {
<span class="fc" id="L400">                        result += stream.write(newLine).await();</span>
                    }
<span class="fc" id="L402">                    result += property.toString(stream, format).await();</span>
<span class="fc" id="L403">                }</span>
<span class="fc bfc" id="L404" title="All 4 branches covered.">                if (hasNewLine &amp;&amp; wroteProperty)</span>
                {
<span class="fc" id="L406">                    result += stream.write(newLine).await();</span>
                }
            }
            finally
            {
<span class="fc" id="L411">                stream.decreaseIndent();</span>
            }
<span class="fc" id="L413">            result += stream.write('}').await();</span>

<span class="fc" id="L415">            PostCondition.assertGreaterThanOrEqualTo(result, 2, &quot;result&quot;);</span>

<span class="fc" id="L417">            return result;</span>
        });
    }

    @Override
    public boolean equals(Object rhs)
    {
<span class="fc bfc" id="L424" title="All 4 branches covered.">        return rhs instanceof JSONObject &amp;&amp; this.equals((JSONObject)rhs);</span>
    }

    public boolean equals(JSONObject rhs)
    {
<span class="fc bfc" id="L429" title="All 2 branches covered.">        return rhs != null &amp;&amp;</span>
<span class="fc bfc" id="L430" title="All 2 branches covered.">            this.properties.equals(rhs.properties);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>