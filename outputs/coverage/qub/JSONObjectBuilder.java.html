<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JSONObjectBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCo Coverage Report</a> &gt; <a href="index.source.html" class="el_package">qub</a> &gt; <span class="el_source">JSONObjectBuilder.java</span></div><h1>JSONObjectBuilder.java</h1><pre class="source lang-java linenums">package qub;

/**
 * A type that can be used to build a JSON object.
 */
public class JSONObjectBuilder implements Disposable
{
    private final CharacterWriteStream stream;
    private final BasicDisposable disposable;
    private boolean wroteFirstProperty;

    /**
     * Create a new JSONObjectBuilder that will write JSON object characters to the provided
     * CharacterWriteStream.
     * @param stream The stream that the JSON object characters will be written to.
     */
    public JSONObjectBuilder(CharacterWriteStream stream)
<span class="fc" id="L18">    {</span>
<span class="fc" id="L19">        PreCondition.assertNotNull(stream, &quot;stream&quot;);</span>
<span class="fc" id="L20">        PreCondition.assertFalse(stream.isDisposed(), &quot;stream.isDisposed()&quot;);</span>

<span class="fc" id="L22">        this.stream = stream;</span>
<span class="fc" id="L23">        stream.write('{').await();</span>
<span class="fc" id="L24">        disposable = BasicDisposable.create(() -&gt; stream.write('}').await());</span>
<span class="fc" id="L25">    }</span>

    private void property(String propertyName, Action0 writePropertyValue)
    {
<span class="fc" id="L29">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>
<span class="fc" id="L30">        PreCondition.assertNotNull(writePropertyValue, &quot;writePropertyValue&quot;);</span>

<span class="fc bfc" id="L32" title="All 2 branches covered.">        if (!wroteFirstProperty)</span>
        {
<span class="fc" id="L34">            wroteFirstProperty = true;</span>
        }
        else
        {
<span class="fc" id="L38">            stream.write(',').await();</span>
        }

<span class="fc" id="L41">        stream.write(Strings.escapeAndQuote(propertyName)).await();</span>
<span class="fc" id="L42">        stream.write(':').await();</span>
<span class="fc" id="L43">        writePropertyValue.run();</span>
<span class="fc" id="L44">    }</span>

    private void property(String propertyName, String propertyValue)
    {
<span class="fc" id="L48">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>
<span class="fc" id="L49">        PreCondition.assertNotNullAndNotEmpty(propertyValue, &quot;propertyValue&quot;);</span>

<span class="fc" id="L51">        property(propertyName, () -&gt; stream.write(propertyValue).await());</span>
<span class="fc" id="L52">    }</span>

    public void booleanProperty(String propertyName, boolean propertyValue)
    {
<span class="fc" id="L56">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>

<span class="fc" id="L58">        property(propertyName, Booleans.toString(propertyValue));</span>
<span class="fc" id="L59">    }</span>

    public void numberProperty(String propertyName, long propertyValue)
    {
<span class="fc" id="L63">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>

<span class="fc" id="L65">        property(propertyName, Longs.toString(propertyValue));</span>
<span class="fc" id="L66">    }</span>

    public void numberProperty(String propertyName, double propertyValue)
    {
<span class="fc" id="L70">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>

<span class="fc" id="L72">        property(propertyName, Doubles.toString(propertyValue));</span>
<span class="fc" id="L73">    }</span>

    public void stringProperty(String propertyName, String propertyValue)
    {
<span class="fc" id="L77">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>
<span class="fc" id="L78">        PreCondition.assertNotNull(propertyValue, &quot;propertyValue&quot;);</span>

<span class="fc" id="L80">        property(propertyName, Strings.escapeAndQuote(propertyValue));</span>
<span class="fc" id="L81">    }</span>

    /**
     * Write a null property.
     * @param propertyName The name of the property.
     */
    public void nullProperty(String propertyName)
    {
<span class="fc" id="L89">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>

<span class="fc" id="L91">        property(propertyName, &quot;null&quot;);</span>
<span class="fc" id="L92">    }</span>

    /**
     * Write a string or null property.
     * @param propertyName The name of the property.
     * @param propertyValue The value of the property.
     */
    public Result&lt;Void&gt; stringOrNullProperty(String propertyName, String propertyValue)
    {
<span class="fc" id="L101">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>

<span class="fc" id="L103">        return Result.create(() -&gt;</span>
        {
<span class="fc bfc" id="L105" title="All 2 branches covered.">            this.property(propertyName, propertyValue == null ? &quot;null&quot; : Strings.escapeAndQuote(propertyValue));</span>
<span class="fc" id="L106">        });</span>
    }

    public void objectProperty(String propertyName)
    {
<span class="fc" id="L111">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>

<span class="fc" id="L113">        objectProperty(propertyName, (JSONObjectBuilder builder) -&gt; {});</span>
<span class="fc" id="L114">    }</span>

    public void objectProperty(String propertyName, Action1&lt;JSONObjectBuilder&gt; action)
    {
<span class="fc" id="L118">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>
<span class="fc" id="L119">        PreCondition.assertNotNull(action, &quot;action&quot;);</span>

<span class="fc" id="L121">        property(propertyName, () -&gt;</span>
        {
<span class="fc" id="L123">            final JSONObjectBuilder objectBuilder = new JSONObjectBuilder(stream);</span>
<span class="fc" id="L124">            action.run(objectBuilder);</span>
<span class="fc" id="L125">            objectBuilder.dispose();</span>
<span class="fc" id="L126">        });</span>
<span class="fc" id="L127">    }</span>

    public void arrayProperty(String propertyName)
    {
<span class="fc" id="L131">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>

<span class="fc" id="L133">        arrayProperty(propertyName, (JSONArrayBuilder builder) -&gt; {});</span>
<span class="fc" id="L134">    }</span>

    public void arrayProperty(String propertyName, Action1&lt;JSONArrayBuilder&gt; action)
    {
<span class="fc" id="L138">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>
<span class="fc" id="L139">        PreCondition.assertNotNull(action, &quot;action&quot;);</span>

<span class="fc" id="L141">        property(propertyName, () -&gt;</span>
        {
<span class="fc" id="L143">            final JSONArrayBuilder arrayBuilder = new JSONArrayBuilder(stream);</span>
<span class="fc" id="L144">            action.run(arrayBuilder);</span>
<span class="fc" id="L145">            arrayBuilder.dispose();</span>
<span class="fc" id="L146">        });</span>
<span class="fc" id="L147">    }</span>

    public void stringArrayProperty(String propertyName)
    {
<span class="fc" id="L151">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>

<span class="fc" id="L153">        stringArrayProperty(propertyName, Iterable.create());</span>
<span class="fc" id="L154">    }</span>

    public void stringArrayProperty(String propertyName, Iterable&lt;String&gt; stringElements)
    {
<span class="fc" id="L158">        PreCondition.assertNotNullAndNotEmpty(propertyName, &quot;propertyName&quot;);</span>
<span class="fc" id="L159">        PreCondition.assertNotNull(stringElements, &quot;stringElements&quot;);</span>

<span class="fc" id="L161">        arrayProperty(propertyName, (JSONArrayBuilder builder) -&gt;</span>
        {
<span class="fc bfc" id="L163" title="All 2 branches covered.">            for (final String stringElement : stringElements)</span>
            {
<span class="fc" id="L165">                builder.stringElement(stringElement);</span>
<span class="fc" id="L166">            }</span>
<span class="fc" id="L167">        });</span>
<span class="fc" id="L168">    }</span>

    @Override
    public boolean isDisposed()
    {
<span class="fc" id="L173">        return disposable.isDisposed();</span>
    }

    @Override
    public Result&lt;Boolean&gt; dispose()
    {
<span class="fc" id="L179">        return disposable.dispose();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>